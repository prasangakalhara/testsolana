{"ast":null,"code":"var _jsxFileName = \"D:\\\\testone\\\\metaplex\\\\js\\\\packages\\\\candy-machine-ui\\\\src\\\\Home.tsx\",\n    _s = $RefreshSig$();\n\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as anchor from '@project-serum/anchor';\nimport styled from 'styled-components';\nimport { Container, Snackbar } from '@material-ui/core';\nimport Paper from '@material-ui/core/Paper';\nimport Alert from '@material-ui/lab/Alert';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { Connection, PublicKey } from '@solana/web3.js';\nimport { useWallet } from '@solana/wallet-adapter-react';\nimport { WalletDialogButton } from '@solana/wallet-adapter-material-ui';\nimport { awaitTransactionSignatureConfirmation, CANDY_MACHINE_PROGRAM, createAccountsForMint, getCandyMachineState, getCollectionPDA, mintOneToken } from './candy-machine';\nimport { formatNumber, getAtaForMint, toDate } from './utils';\nimport { MintCountdown } from './MintCountdown';\nimport { MintButton } from './MintButton';\nimport { GatewayProvider } from '@civic/solana-gateway-react';\nimport { sendTransaction } from './connection';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ConnectButton = styled(WalletDialogButton)`\n  width: 100%;\n  height: 60px;\n  margin-top: 10px;\n  margin-bottom: 5px;\n  background: linear-gradient(180deg, #604ae5 0%, #813eee 100%);\n  color: white;\n  font-size: 16px;\n  font-weight: bold;\n`;\n_c = ConnectButton;\nconst MintContainer = styled.div``; // add your owns styles here\n\n_c2 = MintContainer;\n\nconst Home = props => {\n  _s();\n\n  var _candyMachine$state, _candyMachine$state2, _candyMachine$state2$;\n\n  const [isUserMinting, setIsUserMinting] = useState(false);\n  const [candyMachine, setCandyMachine] = useState();\n  const [alertState, setAlertState] = useState({\n    open: false,\n    message: '',\n    severity: undefined\n  });\n  const [isActive, setIsActive] = useState(false);\n  const [currentShift, setCurrentShift] = useState(0);\n  const [endDate, setEndDate] = useState();\n  const [itemsRemaining, setItemsRemaining] = useState();\n  const [isWhitelistUser, setIsWhitelistUser] = useState(false);\n  const [isPresale, setIsPresale] = useState(false);\n  const [isValidBalance, setIsValidBalance] = useState(false);\n  const [discountPrice, setDiscountPrice] = useState();\n  const [needTxnSplit, setNeedTxnSplit] = useState(true);\n  const [setupTxn, setSetupTxn] = useState();\n  const rpcUrl = props.rpcHost;\n  const wallet = useWallet();\n  const cluster = props.network;\n  const anchorWallet = useMemo(() => {\n    if (!wallet || !wallet.publicKey || !wallet.signAllTransactions || !wallet.signTransaction) {\n      return;\n    }\n\n    return {\n      publicKey: wallet.publicKey,\n      signAllTransactions: wallet.signAllTransactions,\n      signTransaction: wallet.signTransaction\n    };\n  }, [wallet]);\n  const refreshCandyMachineState = useCallback(async function () {\n    let commitment = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'confirmed';\n\n    if (!anchorWallet) {\n      return;\n    }\n\n    if (props.error !== undefined) {\n      setAlertState({\n        open: true,\n        message: props.error,\n        severity: 'error',\n        hideDuration: null\n      });\n      return;\n    }\n\n    const connection = new Connection(props.rpcHost, commitment);\n\n    if (props.candyMachineId) {\n      try {\n        var _cndy$state$goLiveDat, _cndy$state$endSettin, _cndy$state$endSettin2, _cndy$state$whitelist, _cndy$state$whitelist2, _cndy$state$gatekeepe;\n\n        const cndy = await getCandyMachineState(anchorWallet, props.candyMachineId, connection);\n        const currentSlot = await connection.getSlot();\n        const blockTime = await connection.getBlockTime(currentSlot);\n        const shift = new Date().getTime() / 1000 - blockTime;\n        let active = (cndy === null || cndy === void 0 ? void 0 : (_cndy$state$goLiveDat = cndy.state.goLiveDate) === null || _cndy$state$goLiveDat === void 0 ? void 0 : _cndy$state$goLiveDat.toNumber()) + shift < new Date().getTime() / 1000;\n        let presale = false; // duplication of state to make sure we have the right values!\n\n        let isWLUser = false;\n        let userPrice = cndy.state.price; // whitelist mint?\n\n        if (cndy !== null && cndy !== void 0 && cndy.state.whitelistMintSettings) {\n          // is it a presale mint?\n          if (cndy.state.whitelistMintSettings.presale && (!cndy.state.goLiveDate || cndy.state.goLiveDate.toNumber() + shift > new Date().getTime() / 1000)) {\n            presale = true;\n          } // is there a discount?\n\n\n          if (cndy.state.whitelistMintSettings.discountPrice) {\n            setDiscountPrice(cndy.state.whitelistMintSettings.discountPrice);\n            userPrice = cndy.state.whitelistMintSettings.discountPrice;\n          } else {\n            setDiscountPrice(undefined); // when presale=false and discountPrice=null, mint is restricted\n            // to whitelist users only\n\n            if (!cndy.state.whitelistMintSettings.presale) {\n              cndy.state.isWhitelistOnly = true;\n            }\n          } // retrieves the whitelist token\n\n\n          const mint = new anchor.web3.PublicKey(cndy.state.whitelistMintSettings.mint);\n          const token = (await getAtaForMint(mint, anchorWallet.publicKey))[0];\n\n          try {\n            const balance = await connection.getTokenAccountBalance(token);\n            isWLUser = parseInt(balance.value.amount) > 0; // only whitelist the user if the balance > 0\n\n            setIsWhitelistUser(isWLUser);\n\n            if (cndy.state.isWhitelistOnly) {\n              active = isWLUser && (presale || active);\n            }\n          } catch (e) {\n            setIsWhitelistUser(false); // no whitelist user, no mint\n\n            if (cndy.state.isWhitelistOnly) {\n              active = false;\n            }\n\n            console.log('There was a problem fetching whitelist token balance');\n            console.log(e);\n          }\n        }\n\n        userPrice = isWLUser ? userPrice : cndy.state.price;\n\n        if (cndy !== null && cndy !== void 0 && cndy.state.tokenMint) {\n          // retrieves the SPL token\n          const mint = new anchor.web3.PublicKey(cndy.state.tokenMint);\n          const token = (await getAtaForMint(mint, anchorWallet.publicKey))[0];\n\n          try {\n            const balance = await connection.getTokenAccountBalance(token);\n            const valid = new anchor.BN(balance.value.amount).gte(userPrice); // only allow user to mint if token balance >  the user if the balance > 0\n\n            setIsValidBalance(valid);\n            active = active && valid;\n          } catch (e) {\n            setIsValidBalance(false);\n            active = false; // no whitelist user, no mint\n\n            console.log('There was a problem fetching SPL token balance');\n            console.log(e);\n          }\n        } else {\n          const balance = new anchor.BN(await connection.getBalance(anchorWallet.publicKey));\n          const valid = balance.gte(userPrice);\n          setIsValidBalance(valid);\n          active = active && valid;\n        } // datetime to stop the mint?\n\n\n        if (cndy !== null && cndy !== void 0 && (_cndy$state$endSettin = cndy.state.endSettings) !== null && _cndy$state$endSettin !== void 0 && _cndy$state$endSettin.endSettingType.date) {\n          setEndDate(toDate(cndy.state.endSettings.number.add(new anchor.BN(shift))));\n\n          if (new Date().getTime() / 1000 > cndy.state.endSettings.number.toNumber() + shift) {\n            active = false;\n          }\n        } // amount to stop the mint?\n\n\n        if (cndy !== null && cndy !== void 0 && (_cndy$state$endSettin2 = cndy.state.endSettings) !== null && _cndy$state$endSettin2 !== void 0 && _cndy$state$endSettin2.endSettingType.amount) {\n          let limit = Math.min(cndy.state.endSettings.number.toNumber(), cndy.state.itemsAvailable);\n\n          if (cndy.state.itemsRedeemed < limit) {\n            setItemsRemaining(limit - cndy.state.itemsRedeemed);\n          } else {\n            setItemsRemaining(0);\n            cndy.state.isSoldOut = true;\n          }\n        } else {\n          setItemsRemaining(cndy.state.itemsRemaining);\n        }\n\n        if (cndy.state.isSoldOut) {\n          active = false;\n        }\n\n        const [collectionPDA] = await getCollectionPDA(props.candyMachineId);\n        const collectionPDAAccount = await connection.getAccountInfo(collectionPDA);\n        setIsActive(cndy.state.isActive = active);\n        setCurrentShift(shift);\n        setIsPresale(cndy.state.isPresale = presale);\n        setCandyMachine(cndy);\n        const txnEstimate = 892 + (!!collectionPDAAccount && cndy.state.retainAuthority ? 182 : 0) + (cndy.state.tokenMint ? 66 : 0) + (cndy.state.whitelistMintSettings ? 34 : 0) + ((_cndy$state$whitelist = cndy.state.whitelistMintSettings) !== null && _cndy$state$whitelist !== void 0 && (_cndy$state$whitelist2 = _cndy$state$whitelist.mode) !== null && _cndy$state$whitelist2 !== void 0 && _cndy$state$whitelist2.burnEveryTime ? 34 : 0) + (cndy.state.gatekeeper ? 33 : 0) + ((_cndy$state$gatekeepe = cndy.state.gatekeeper) !== null && _cndy$state$gatekeepe !== void 0 && _cndy$state$gatekeepe.expireOnUse ? 66 : 0);\n        setNeedTxnSplit(txnEstimate > 1230);\n      } catch (e) {\n        if (e instanceof Error) {\n          if (e.message === `Account does not exist ${props.candyMachineId}`) {\n            setAlertState({\n              open: true,\n              message: `Couldn't fetch candy machine state from candy machine with address: ${props.candyMachineId}, using rpc: ${props.rpcHost}! You probably typed the REACT_APP_CANDY_MACHINE_ID value in wrong in your .env file, or you are using the wrong RPC!`,\n              severity: 'error',\n              hideDuration: null\n            });\n          } else if (e.message.startsWith('failed to get info about account')) {\n            setAlertState({\n              open: true,\n              message: `Couldn't fetch candy machine state with rpc: ${props.rpcHost}! This probably means you have an issue with the REACT_APP_SOLANA_RPC_HOST value in your .env file, or you are not using a custom RPC!`,\n              severity: 'error',\n              hideDuration: null\n            });\n          }\n        } else {\n          setAlertState({\n            open: true,\n            message: `${e}`,\n            severity: 'error',\n            hideDuration: null\n          });\n        }\n\n        console.log(e);\n      }\n    } else {\n      setAlertState({\n        open: true,\n        message: `Your REACT_APP_CANDY_MACHINE_ID value in the .env file doesn't look right! Make sure you enter it in as plain base-58 address!`,\n        severity: 'error',\n        hideDuration: null\n      });\n    }\n  }, [anchorWallet, props.candyMachineId, props.error, props.rpcHost]);\n\n  const onMint = async function () {\n    let beforeTransactions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let afterTransactions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n    try {\n      var _document$getElementB;\n\n      setIsUserMinting(true);\n      (_document$getElementB = document.getElementById('#identity')) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.click();\n\n      if (wallet.connected && candyMachine !== null && candyMachine !== void 0 && candyMachine.program && wallet.publicKey) {\n        var _setupMint;\n\n        let setupMint;\n\n        if (needTxnSplit && setupTxn === undefined) {\n          setAlertState({\n            open: true,\n            message: 'Please sign account setup transaction',\n            severity: 'info'\n          });\n          setupMint = await createAccountsForMint(candyMachine, wallet.publicKey);\n          let status = {\n            err: true\n          };\n\n          if (setupMint.transaction) {\n            status = await awaitTransactionSignatureConfirmation(setupMint.transaction, props.txTimeout, props.connection, true);\n          }\n\n          if (status && !status.err) {\n            setSetupTxn(setupMint);\n            setAlertState({\n              open: true,\n              message: 'Setup transaction succeeded! Please sign minting transaction',\n              severity: 'info'\n            });\n          } else {\n            setAlertState({\n              open: true,\n              message: 'Mint failed! Please try again!',\n              severity: 'error'\n            });\n            setIsUserMinting(false);\n            return;\n          }\n        } else {\n          setAlertState({\n            open: true,\n            message: 'Please sign minting transaction',\n            severity: 'info'\n          });\n        }\n\n        let mintResult = await mintOneToken(candyMachine, wallet.publicKey, beforeTransactions, afterTransactions, (_setupMint = setupMint) !== null && _setupMint !== void 0 ? _setupMint : setupTxn);\n        let status = {\n          err: true\n        };\n        let metadataStatus = null;\n\n        if (mintResult) {\n          status = await awaitTransactionSignatureConfirmation(mintResult.mintTxId, props.txTimeout, props.connection, true);\n          metadataStatus = await candyMachine.program.provider.connection.getAccountInfo(mintResult.metadataKey, 'processed');\n          console.log('Metadata status: ', !!metadataStatus);\n        }\n\n        if (status && !status.err && metadataStatus) {\n          // manual update since the refresh might not detect\n          // the change immediately\n          let remaining = itemsRemaining - 1;\n          setItemsRemaining(remaining);\n          setIsActive(candyMachine.state.isActive = remaining > 0);\n          candyMachine.state.isSoldOut = remaining === 0;\n          setSetupTxn(undefined);\n          setAlertState({\n            open: true,\n            message: 'Congratulations! Mint succeeded!',\n            severity: 'success',\n            hideDuration: 7000\n          });\n          refreshCandyMachineState('processed');\n        } else if (status && !status.err) {\n          setAlertState({\n            open: true,\n            message: 'Mint likely failed! Anti-bot SOL 0.01 fee potentially charged! Check the explorer to confirm the mint failed and if so, make sure you are eligible to mint before trying again.',\n            severity: 'error',\n            hideDuration: 8000\n          });\n          refreshCandyMachineState();\n        } else {\n          setAlertState({\n            open: true,\n            message: 'Mint failed! Please try again!',\n            severity: 'error'\n          });\n          refreshCandyMachineState();\n        }\n      }\n    } catch (error) {\n      let message = error.msg || 'Minting failed! Please try again!';\n\n      if (!error.msg) {\n        if (!error.message) {\n          message = 'Transaction timeout! Please try again.';\n        } else if (error.message.indexOf('0x137')) {\n          console.log(error);\n          message = `SOLD OUT!`;\n        } else if (error.message.indexOf('0x135')) {\n          message = `Insufficient funds to mint. Please fund your wallet.`;\n        }\n      } else {\n        if (error.code === 311) {\n          console.log(error);\n          message = `SOLD OUT!`;\n          window.location.reload();\n        } else if (error.code === 312) {\n          message = `Minting period hasn't started yet.`;\n        }\n      }\n\n      setAlertState({\n        open: true,\n        message,\n        severity: 'error'\n      }); // updates the candy machine state to reflect the latest\n      // information on chain\n\n      refreshCandyMachineState();\n    } finally {\n      setIsUserMinting(false);\n    }\n  };\n\n  const toggleMintButton = currentShift => {\n    let active = !isActive || isPresale;\n\n    if (active) {\n      if (candyMachine.state.isWhitelistOnly && !isWhitelistUser) {\n        active = false;\n      }\n\n      if (endDate && Date.now() >= endDate.getTime()) {\n        active = false;\n      }\n    }\n\n    console.log(candyMachine.state.goLiveDate.toNumber() + currentShift <= new Date().getTime() / 1000);\n\n    if (isPresale && candyMachine.state.goLiveDate && candyMachine.state.goLiveDate.toNumber() + currentShift <= new Date().getTime() / 1000) {\n      setIsPresale(candyMachine.state.isPresale = false);\n    }\n\n    setIsActive(candyMachine.state.isActive = active);\n  };\n\n  useEffect(() => {\n    refreshCandyMachineState();\n  }, [anchorWallet, props.candyMachineId, props.connection, refreshCandyMachineState]);\n  useEffect(() => {\n    (function loop() {\n      setTimeout(() => {\n        refreshCandyMachineState();\n        loop();\n      }, 20000);\n    })();\n  }, [refreshCandyMachineState]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    style: {\n      marginTop: 100\n    },\n    children: [/*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: \"xs\",\n      style: {\n        position: 'relative'\n      },\n      children: /*#__PURE__*/_jsxDEV(Paper, {\n        style: {\n          padding: 24,\n          paddingBottom: 10,\n          backgroundColor: '#151A1F',\n          borderRadius: 6\n        },\n        children: [!wallet.connected ? /*#__PURE__*/_jsxDEV(ConnectButton, {\n          children: \"Connect Wallet\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [candyMachine && /*#__PURE__*/_jsxDEV(Grid, {\n            container: true,\n            direction: \"row\",\n            justifyContent: \"center\",\n            wrap: \"nowrap\",\n            children: [/*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 3,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                children: \"Remaining\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 528,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                color: \"textPrimary\",\n                style: {\n                  fontWeight: 'bold'\n                },\n                children: `${itemsRemaining}`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 531,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 527,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 4,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                children: isWhitelistUser && discountPrice ? 'Discount Price' : 'Price'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 542,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                color: \"textPrimary\",\n                style: {\n                  fontWeight: 'bold'\n                },\n                children: isWhitelistUser && discountPrice ? `◎ ${formatNumber.asNumber(discountPrice)}` : `◎ ${formatNumber.asNumber(candyMachine.state.price)}`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 547,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 541,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 5,\n              children: isActive && endDate && Date.now() < endDate.getTime() ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(MintCountdown, {\n                  date: getCountdownDate(candyMachine, currentShift),\n                  style: {\n                    justifyContent: 'flex-end'\n                  },\n                  status: \"COMPLETED\",\n                  onComplete: () => toggleMintButton(currentShift)\n                }, \"endSettings\", false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 562,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  align: \"center\",\n                  display: \"block\",\n                  style: {\n                    fontWeight: 'bold'\n                  },\n                  children: \"TO END OF MINT\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 569,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(MintCountdown, {\n                  date: getCountdownDate(candyMachine, currentShift),\n                  style: {\n                    justifyContent: 'flex-end'\n                  },\n                  status: candyMachine !== null && candyMachine !== void 0 && (_candyMachine$state = candyMachine.state) !== null && _candyMachine$state !== void 0 && _candyMachine$state.isSoldOut || endDate && Date.now() > endDate.getTime() ? 'COMPLETED' : isPresale ? 'PRESALE' : 'LIVE',\n                  onComplete: () => toggleMintButton(currentShift)\n                }, \"goLive\", false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 580,\n                  columnNumber: 25\n                }, this), isPresale && candyMachine.state.goLiveDate && candyMachine.state.goLiveDate.toNumber() + currentShift > new Date().getTime() / 1000 && /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  align: \"center\",\n                  display: \"block\",\n                  style: {\n                    fontWeight: 'bold'\n                  },\n                  children: \"UNTIL PUBLIC MINT\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 599,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 559,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 521,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(MintContainer, {\n            children: candyMachine !== null && candyMachine !== void 0 && candyMachine.state.isActive && candyMachine !== null && candyMachine !== void 0 && candyMachine.state.gatekeeper && wallet.publicKey && wallet.signTransaction ? /*#__PURE__*/_jsxDEV(GatewayProvider, {\n              wallet: {\n                publicKey: wallet.publicKey || new PublicKey(CANDY_MACHINE_PROGRAM),\n                //@ts-ignore\n                signTransaction: wallet.signTransaction\n              },\n              gatekeeperNetwork: candyMachine === null || candyMachine === void 0 ? void 0 : (_candyMachine$state2 = candyMachine.state) === null || _candyMachine$state2 === void 0 ? void 0 : (_candyMachine$state2$ = _candyMachine$state2.gatekeeper) === null || _candyMachine$state2$ === void 0 ? void 0 : _candyMachine$state2$.gatekeeperNetwork,\n              clusterUrl: rpcUrl,\n              cluster: cluster,\n              handleTransaction: async transaction => {\n                setIsUserMinting(true);\n                const userMustSign = transaction.signatures.find(sig => sig.publicKey.equals(wallet.publicKey));\n\n                if (userMustSign) {\n                  setAlertState({\n                    open: true,\n                    message: 'Please sign one-time Civic Pass issuance',\n                    severity: 'info'\n                  });\n\n                  try {\n                    transaction = await wallet.signTransaction(transaction);\n                  } catch (e) {\n                    setAlertState({\n                      open: true,\n                      message: 'User cancelled signing',\n                      severity: 'error'\n                    }); // setTimeout(() => window.location.reload(), 2000);\n\n                    setIsUserMinting(false);\n                    throw e;\n                  }\n                } else {\n                  setAlertState({\n                    open: true,\n                    message: 'Refreshing Civic Pass',\n                    severity: 'info'\n                  });\n                }\n\n                try {\n                  await sendTransaction(props.connection, wallet, transaction, [], true, 'confirmed');\n                  setAlertState({\n                    open: true,\n                    message: 'Please sign minting',\n                    severity: 'info'\n                  });\n                } catch (e) {\n                  setAlertState({\n                    open: true,\n                    message: 'Solana dropped the transaction, please try again',\n                    severity: 'warning'\n                  });\n                  console.error(e); // setTimeout(() => window.location.reload(), 2000);\n\n                  setIsUserMinting(false);\n                  throw e;\n                }\n\n                await onMint();\n              },\n              broadcastTransaction: false,\n              options: {\n                autoShowModal: false\n              },\n              children: /*#__PURE__*/_jsxDEV(MintButton, {\n                candyMachine: candyMachine,\n                isMinting: isUserMinting,\n                setIsMinting: val => setIsUserMinting(val),\n                onMint: onMint,\n                isActive: isActive || isPresale && isWhitelistUser && isValidBalance\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 694,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 618,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(MintButton, {\n              candyMachine: candyMachine,\n              isMinting: isUserMinting,\n              setIsMinting: val => setIsUserMinting(val),\n              onMint: onMint,\n              isActive: isActive || isPresale && isWhitelistUser && isValidBalance\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 706,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"caption\",\n          align: \"center\",\n          display: \"block\",\n          style: {\n            marginTop: 7,\n            color: 'grey'\n          },\n          children: \"Powered by METAPLEX\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 720,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 508,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 507,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n      open: alertState.open,\n      autoHideDuration: alertState.hideDuration === undefined ? 6000 : alertState.hideDuration,\n      onClose: () => setAlertState({ ...alertState,\n        open: false\n      }),\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        onClose: () => setAlertState({ ...alertState,\n          open: false\n        }),\n        severity: alertState.severity,\n        children: alertState.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 738,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 731,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 506,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Home, \"GdiBoM6Pr4sPgZETJsYLZ40QvwA=\", false, function () {\n  return [useWallet];\n});\n\n_c3 = Home;\n\nconst getCountdownDate = (candyMachine, currentShift) => {\n  var _candyMachine$state$e;\n\n  if (candyMachine.state.isActive && (_candyMachine$state$e = candyMachine.state.endSettings) !== null && _candyMachine$state$e !== void 0 && _candyMachine$state$e.endSettingType.date) {\n    return toDate(candyMachine.state.endSettings.number);\n  }\n\n  return toDate(candyMachine.state.goLiveDate ? new anchor.BN(candyMachine.state.goLiveDate.toNumber() + currentShift) : candyMachine.state.isPresale ? new anchor.BN(new Date().getTime() / 1000) : undefined);\n};\n\nexport default Home;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"ConnectButton\");\n$RefreshReg$(_c2, \"MintContainer\");\n$RefreshReg$(_c3, \"Home\");","map":{"version":3,"sources":["D:/testone/metaplex/js/packages/candy-machine-ui/src/Home.tsx"],"names":["useCallback","useEffect","useMemo","useState","anchor","styled","Container","Snackbar","Paper","Alert","Grid","Typography","Connection","PublicKey","useWallet","WalletDialogButton","awaitTransactionSignatureConfirmation","CANDY_MACHINE_PROGRAM","createAccountsForMint","getCandyMachineState","getCollectionPDA","mintOneToken","formatNumber","getAtaForMint","toDate","MintCountdown","MintButton","GatewayProvider","sendTransaction","ConnectButton","MintContainer","div","Home","props","isUserMinting","setIsUserMinting","candyMachine","setCandyMachine","alertState","setAlertState","open","message","severity","undefined","isActive","setIsActive","currentShift","setCurrentShift","endDate","setEndDate","itemsRemaining","setItemsRemaining","isWhitelistUser","setIsWhitelistUser","isPresale","setIsPresale","isValidBalance","setIsValidBalance","discountPrice","setDiscountPrice","needTxnSplit","setNeedTxnSplit","setupTxn","setSetupTxn","rpcUrl","rpcHost","wallet","cluster","network","anchorWallet","publicKey","signAllTransactions","signTransaction","refreshCandyMachineState","commitment","error","hideDuration","connection","candyMachineId","cndy","currentSlot","getSlot","blockTime","getBlockTime","shift","Date","getTime","active","state","goLiveDate","toNumber","presale","isWLUser","userPrice","price","whitelistMintSettings","isWhitelistOnly","mint","web3","token","balance","getTokenAccountBalance","parseInt","value","amount","e","console","log","tokenMint","valid","BN","gte","getBalance","endSettings","endSettingType","date","number","add","limit","Math","min","itemsAvailable","itemsRedeemed","isSoldOut","collectionPDA","collectionPDAAccount","getAccountInfo","txnEstimate","retainAuthority","mode","burnEveryTime","gatekeeper","expireOnUse","Error","startsWith","onMint","beforeTransactions","afterTransactions","document","getElementById","click","connected","program","setupMint","status","err","transaction","txTimeout","mintResult","metadataStatus","mintTxId","provider","metadataKey","remaining","msg","indexOf","code","window","location","reload","toggleMintButton","now","loop","setTimeout","marginTop","position","padding","paddingBottom","backgroundColor","borderRadius","fontWeight","asNumber","getCountdownDate","justifyContent","gatekeeperNetwork","userMustSign","signatures","find","sig","equals","autoShowModal","val","color"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport * as anchor from '@project-serum/anchor';\r\n\r\nimport styled from 'styled-components';\r\nimport { Container, Snackbar } from '@material-ui/core';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport {\r\n  Commitment,\r\n  Connection,\r\n  PublicKey,\r\n  Transaction,\r\n} from '@solana/web3.js';\r\nimport { useWallet } from '@solana/wallet-adapter-react';\r\nimport { WalletDialogButton } from '@solana/wallet-adapter-material-ui';\r\nimport {\r\n  awaitTransactionSignatureConfirmation,\r\n  CANDY_MACHINE_PROGRAM,\r\n  CandyMachineAccount,\r\n  createAccountsForMint,\r\n  getCandyMachineState,\r\n  getCollectionPDA,\r\n  mintOneToken,\r\n  SetupState,\r\n} from './candy-machine';\r\nimport { AlertState, formatNumber, getAtaForMint, toDate } from './utils';\r\nimport { MintCountdown } from './MintCountdown';\r\nimport { MintButton } from './MintButton';\r\nimport { GatewayProvider } from '@civic/solana-gateway-react';\r\nimport { sendTransaction } from './connection';\r\nimport { WalletAdapterNetwork } from '@solana/wallet-adapter-base';\r\n\r\nconst ConnectButton = styled(WalletDialogButton)`\r\n  width: 100%;\r\n  height: 60px;\r\n  margin-top: 10px;\r\n  margin-bottom: 5px;\r\n  background: linear-gradient(180deg, #604ae5 0%, #813eee 100%);\r\n  color: white;\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n`;\r\n\r\nconst MintContainer = styled.div``; // add your owns styles here\r\n\r\nexport interface HomeProps {\r\n  candyMachineId?: anchor.web3.PublicKey;\r\n  connection: anchor.web3.Connection;\r\n  txTimeout: number;\r\n  rpcHost: string;\r\n  network: WalletAdapterNetwork;\r\n  error?: string;\r\n}\r\n\r\nconst Home = (props: HomeProps) => {\r\n  const [isUserMinting, setIsUserMinting] = useState(false);\r\n  const [candyMachine, setCandyMachine] = useState<CandyMachineAccount>();\r\n  const [alertState, setAlertState] = useState<AlertState>({\r\n    open: false,\r\n    message: '',\r\n    severity: undefined,\r\n  });\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [currentShift, setCurrentShift] = useState<number>(0);\r\n  const [endDate, setEndDate] = useState<Date>();\r\n  const [itemsRemaining, setItemsRemaining] = useState<number>();\r\n  const [isWhitelistUser, setIsWhitelistUser] = useState(false);\r\n  const [isPresale, setIsPresale] = useState(false);\r\n  const [isValidBalance, setIsValidBalance] = useState(false);\r\n  const [discountPrice, setDiscountPrice] = useState<anchor.BN>();\r\n  const [needTxnSplit, setNeedTxnSplit] = useState(true);\r\n  const [setupTxn, setSetupTxn] = useState<SetupState>();\r\n\r\n  const rpcUrl = props.rpcHost;\r\n  const wallet = useWallet();\r\n  const cluster = props.network;\r\n  const anchorWallet = useMemo(() => {\r\n    if (\r\n      !wallet ||\r\n      !wallet.publicKey ||\r\n      !wallet.signAllTransactions ||\r\n      !wallet.signTransaction\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    return {\r\n      publicKey: wallet.publicKey,\r\n      signAllTransactions: wallet.signAllTransactions,\r\n      signTransaction: wallet.signTransaction,\r\n    } as anchor.Wallet;\r\n  }, [wallet]);\r\n\r\n  const refreshCandyMachineState = useCallback(\r\n    async (commitment: Commitment = 'confirmed') => {\r\n      if (!anchorWallet) {\r\n        return;\r\n      }\r\n      if (props.error !== undefined) {\r\n        setAlertState({\r\n          open: true,\r\n          message: props.error,\r\n          severity: 'error',\r\n          hideDuration: null,\r\n        });\r\n        return;\r\n      }\r\n\r\n      const connection = new Connection(props.rpcHost, commitment);\r\n\r\n      if (props.candyMachineId) {\r\n        try {\r\n          const cndy = await getCandyMachineState(\r\n            anchorWallet,\r\n            props.candyMachineId,\r\n            connection,\r\n          );\r\n          const currentSlot = await connection.getSlot();\r\n          const blockTime = (await connection.getBlockTime(\r\n            currentSlot,\r\n          )) as number;\r\n          const shift = new Date().getTime() / 1000 - blockTime;\r\n\r\n          let active =\r\n            cndy?.state.goLiveDate?.toNumber() + shift <\r\n            new Date().getTime() / 1000;\r\n          let presale = false;\r\n\r\n          // duplication of state to make sure we have the right values!\r\n          let isWLUser = false;\r\n          let userPrice = cndy.state.price;\r\n\r\n          // whitelist mint?\r\n          if (cndy?.state.whitelistMintSettings) {\r\n            // is it a presale mint?\r\n            if (\r\n              cndy.state.whitelistMintSettings.presale &&\r\n              (!cndy.state.goLiveDate ||\r\n                cndy.state.goLiveDate.toNumber() + shift >\r\n                  new Date().getTime() / 1000)\r\n            ) {\r\n              presale = true;\r\n            }\r\n            // is there a discount?\r\n            if (cndy.state.whitelistMintSettings.discountPrice) {\r\n              setDiscountPrice(cndy.state.whitelistMintSettings.discountPrice);\r\n              userPrice = cndy.state.whitelistMintSettings.discountPrice;\r\n            } else {\r\n              setDiscountPrice(undefined);\r\n              // when presale=false and discountPrice=null, mint is restricted\r\n              // to whitelist users only\r\n              if (!cndy.state.whitelistMintSettings.presale) {\r\n                cndy.state.isWhitelistOnly = true;\r\n              }\r\n            }\r\n            // retrieves the whitelist token\r\n            const mint = new anchor.web3.PublicKey(\r\n              cndy.state.whitelistMintSettings.mint,\r\n            );\r\n            const token = (\r\n              await getAtaForMint(mint, anchorWallet.publicKey)\r\n            )[0];\r\n\r\n            try {\r\n              const balance = await connection.getTokenAccountBalance(token);\r\n              isWLUser = parseInt(balance.value.amount) > 0;\r\n              // only whitelist the user if the balance > 0\r\n              setIsWhitelistUser(isWLUser);\r\n\r\n              if (cndy.state.isWhitelistOnly) {\r\n                active = isWLUser && (presale || active);\r\n              }\r\n            } catch (e) {\r\n              setIsWhitelistUser(false);\r\n              // no whitelist user, no mint\r\n              if (cndy.state.isWhitelistOnly) {\r\n                active = false;\r\n              }\r\n              console.log(\r\n                'There was a problem fetching whitelist token balance',\r\n              );\r\n              console.log(e);\r\n            }\r\n          }\r\n          userPrice = isWLUser ? userPrice : cndy.state.price;\r\n\r\n          if (cndy?.state.tokenMint) {\r\n            // retrieves the SPL token\r\n            const mint = new anchor.web3.PublicKey(cndy.state.tokenMint);\r\n            const token = (\r\n              await getAtaForMint(mint, anchorWallet.publicKey)\r\n            )[0];\r\n            try {\r\n              const balance = await connection.getTokenAccountBalance(token);\r\n\r\n              const valid = new anchor.BN(balance.value.amount).gte(userPrice);\r\n\r\n              // only allow user to mint if token balance >  the user if the balance > 0\r\n              setIsValidBalance(valid);\r\n              active = active && valid;\r\n            } catch (e) {\r\n              setIsValidBalance(false);\r\n              active = false;\r\n              // no whitelist user, no mint\r\n              console.log('There was a problem fetching SPL token balance');\r\n              console.log(e);\r\n            }\r\n          } else {\r\n            const balance = new anchor.BN(\r\n              await connection.getBalance(anchorWallet.publicKey),\r\n            );\r\n            const valid = balance.gte(userPrice);\r\n            setIsValidBalance(valid);\r\n            active = active && valid;\r\n          }\r\n\r\n          // datetime to stop the mint?\r\n          if (cndy?.state.endSettings?.endSettingType.date) {\r\n            setEndDate(\r\n              toDate(cndy.state.endSettings.number.add(new anchor.BN(shift))),\r\n            );\r\n            if (\r\n              new Date().getTime() / 1000 >\r\n              cndy.state.endSettings.number.toNumber() + shift\r\n            ) {\r\n              active = false;\r\n            }\r\n          }\r\n          // amount to stop the mint?\r\n          if (cndy?.state.endSettings?.endSettingType.amount) {\r\n            let limit = Math.min(\r\n              cndy.state.endSettings.number.toNumber(),\r\n              cndy.state.itemsAvailable,\r\n            );\r\n            if (cndy.state.itemsRedeemed < limit) {\r\n              setItemsRemaining(limit - cndy.state.itemsRedeemed);\r\n            } else {\r\n              setItemsRemaining(0);\r\n              cndy.state.isSoldOut = true;\r\n            }\r\n          } else {\r\n            setItemsRemaining(cndy.state.itemsRemaining);\r\n          }\r\n\r\n          if (cndy.state.isSoldOut) {\r\n            active = false;\r\n          }\r\n\r\n          const [collectionPDA] = await getCollectionPDA(props.candyMachineId);\r\n          const collectionPDAAccount = await connection.getAccountInfo(\r\n            collectionPDA,\r\n          );\r\n          setIsActive((cndy.state.isActive = active));\r\n          setCurrentShift(shift);\r\n\r\n          setIsPresale((cndy.state.isPresale = presale));\r\n          setCandyMachine(cndy);\r\n\r\n          const txnEstimate =\r\n            892 +\r\n            (!!collectionPDAAccount && cndy.state.retainAuthority ? 182 : 0) +\r\n            (cndy.state.tokenMint ? 66 : 0) +\r\n            (cndy.state.whitelistMintSettings ? 34 : 0) +\r\n            (cndy.state.whitelistMintSettings?.mode?.burnEveryTime ? 34 : 0) +\r\n            (cndy.state.gatekeeper ? 33 : 0) +\r\n            (cndy.state.gatekeeper?.expireOnUse ? 66 : 0);\r\n\r\n          setNeedTxnSplit(txnEstimate > 1230);\r\n        } catch (e) {\r\n          if (e instanceof Error) {\r\n            if (\r\n              e.message === `Account does not exist ${props.candyMachineId}`\r\n            ) {\r\n              setAlertState({\r\n                open: true,\r\n                message: `Couldn't fetch candy machine state from candy machine with address: ${props.candyMachineId}, using rpc: ${props.rpcHost}! You probably typed the REACT_APP_CANDY_MACHINE_ID value in wrong in your .env file, or you are using the wrong RPC!`,\r\n                severity: 'error',\r\n                hideDuration: null,\r\n              });\r\n            } else if (\r\n              e.message.startsWith('failed to get info about account')\r\n            ) {\r\n              setAlertState({\r\n                open: true,\r\n                message: `Couldn't fetch candy machine state with rpc: ${props.rpcHost}! This probably means you have an issue with the REACT_APP_SOLANA_RPC_HOST value in your .env file, or you are not using a custom RPC!`,\r\n                severity: 'error',\r\n                hideDuration: null,\r\n              });\r\n            }\r\n          } else {\r\n            setAlertState({\r\n              open: true,\r\n              message: `${e}`,\r\n              severity: 'error',\r\n              hideDuration: null,\r\n            });\r\n          }\r\n          console.log(e);\r\n        }\r\n      } else {\r\n        setAlertState({\r\n          open: true,\r\n          message: `Your REACT_APP_CANDY_MACHINE_ID value in the .env file doesn't look right! Make sure you enter it in as plain base-58 address!`,\r\n          severity: 'error',\r\n          hideDuration: null,\r\n        });\r\n      }\r\n    },\r\n    [anchorWallet, props.candyMachineId, props.error, props.rpcHost],\r\n  );\r\n\r\n  const onMint = async (\r\n    beforeTransactions: Transaction[] = [],\r\n    afterTransactions: Transaction[] = [],\r\n  ) => {\r\n    try {\r\n      setIsUserMinting(true);\r\n      document.getElementById('#identity')?.click();\r\n      if (wallet.connected && candyMachine?.program && wallet.publicKey) {\r\n        let setupMint: SetupState | undefined;\r\n        if (needTxnSplit && setupTxn === undefined) {\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Please sign account setup transaction',\r\n            severity: 'info',\r\n          });\r\n          setupMint = await createAccountsForMint(\r\n            candyMachine,\r\n            wallet.publicKey,\r\n          );\r\n          let status: any = { err: true };\r\n          if (setupMint.transaction) {\r\n            status = await awaitTransactionSignatureConfirmation(\r\n              setupMint.transaction,\r\n              props.txTimeout,\r\n              props.connection,\r\n              true,\r\n            );\r\n          }\r\n          if (status && !status.err) {\r\n            setSetupTxn(setupMint);\r\n            setAlertState({\r\n              open: true,\r\n              message:\r\n                'Setup transaction succeeded! Please sign minting transaction',\r\n              severity: 'info',\r\n            });\r\n          } else {\r\n            setAlertState({\r\n              open: true,\r\n              message: 'Mint failed! Please try again!',\r\n              severity: 'error',\r\n            });\r\n            setIsUserMinting(false);\r\n            return;\r\n          }\r\n        } else {\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Please sign minting transaction',\r\n            severity: 'info',\r\n          });\r\n        }\r\n\r\n        let mintResult = await mintOneToken(\r\n          candyMachine,\r\n          wallet.publicKey,\r\n          beforeTransactions,\r\n          afterTransactions,\r\n          setupMint ?? setupTxn,\r\n        );\r\n\r\n        let status: any = { err: true };\r\n        let metadataStatus = null;\r\n        if (mintResult) {\r\n          status = await awaitTransactionSignatureConfirmation(\r\n            mintResult.mintTxId,\r\n            props.txTimeout,\r\n            props.connection,\r\n            true,\r\n          );\r\n\r\n          metadataStatus =\r\n            await candyMachine.program.provider.connection.getAccountInfo(\r\n              mintResult.metadataKey,\r\n              'processed',\r\n            );\r\n          console.log('Metadata status: ', !!metadataStatus);\r\n        }\r\n\r\n        if (status && !status.err && metadataStatus) {\r\n          // manual update since the refresh might not detect\r\n          // the change immediately\r\n          let remaining = itemsRemaining! - 1;\r\n          setItemsRemaining(remaining);\r\n          setIsActive((candyMachine.state.isActive = remaining > 0));\r\n          candyMachine.state.isSoldOut = remaining === 0;\r\n          setSetupTxn(undefined);\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Congratulations! Mint succeeded!',\r\n            severity: 'success',\r\n            hideDuration: 7000,\r\n          });\r\n          refreshCandyMachineState('processed');\r\n        } else if (status && !status.err) {\r\n          setAlertState({\r\n            open: true,\r\n            message:\r\n              'Mint likely failed! Anti-bot SOL 0.01 fee potentially charged! Check the explorer to confirm the mint failed and if so, make sure you are eligible to mint before trying again.',\r\n            severity: 'error',\r\n            hideDuration: 8000,\r\n          });\r\n          refreshCandyMachineState();\r\n        } else {\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Mint failed! Please try again!',\r\n            severity: 'error',\r\n          });\r\n          refreshCandyMachineState();\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      let message = error.msg || 'Minting failed! Please try again!';\r\n      if (!error.msg) {\r\n        if (!error.message) {\r\n          message = 'Transaction timeout! Please try again.';\r\n        } else if (error.message.indexOf('0x137')) {\r\n          console.log(error);\r\n          message = `SOLD OUT!`;\r\n        } else if (error.message.indexOf('0x135')) {\r\n          message = `Insufficient funds to mint. Please fund your wallet.`;\r\n        }\r\n      } else {\r\n        if (error.code === 311) {\r\n          console.log(error);\r\n          message = `SOLD OUT!`;\r\n          window.location.reload();\r\n        } else if (error.code === 312) {\r\n          message = `Minting period hasn't started yet.`;\r\n        }\r\n      }\r\n\r\n      setAlertState({\r\n        open: true,\r\n        message,\r\n        severity: 'error',\r\n      });\r\n      // updates the candy machine state to reflect the latest\r\n      // information on chain\r\n      refreshCandyMachineState();\r\n    } finally {\r\n      setIsUserMinting(false);\r\n    }\r\n  };\r\n\r\n  const toggleMintButton = (currentShift: number) => {\r\n    let active = !isActive || isPresale;\r\n\r\n    if (active) {\r\n      if (candyMachine!.state.isWhitelistOnly && !isWhitelistUser) {\r\n        active = false;\r\n      }\r\n      if (endDate && Date.now() >= endDate.getTime()) {\r\n        active = false;\r\n      }\r\n    }\r\n    console.log(\r\n      candyMachine!.state.goLiveDate.toNumber() + currentShift <=\r\n        new Date().getTime() / 1000,\r\n    );\r\n    if (\r\n      isPresale &&\r\n      candyMachine!.state.goLiveDate &&\r\n      candyMachine!.state.goLiveDate.toNumber() + currentShift <=\r\n        new Date().getTime() / 1000\r\n    ) {\r\n      setIsPresale((candyMachine!.state.isPresale = false));\r\n    }\r\n\r\n    setIsActive((candyMachine!.state.isActive = active));\r\n  };\r\n\r\n  useEffect(() => {\r\n    refreshCandyMachineState();\r\n  }, [\r\n    anchorWallet,\r\n    props.candyMachineId,\r\n    props.connection,\r\n    refreshCandyMachineState,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    (function loop() {\r\n      setTimeout(() => {\r\n        refreshCandyMachineState();\r\n        loop();\r\n      }, 20000);\r\n    })();\r\n  }, [refreshCandyMachineState]);\r\n\r\n  return (\r\n    <Container style={{ marginTop: 100 }}>\r\n      <Container maxWidth=\"xs\" style={{ position: 'relative' }}>\r\n        <Paper\r\n          style={{\r\n            padding: 24,\r\n            paddingBottom: 10,\r\n            backgroundColor: '#151A1F',\r\n            borderRadius: 6,\r\n          }}\r\n        >\r\n          {!wallet.connected ? (\r\n            <ConnectButton>Connect Wallet</ConnectButton>\r\n          ) : (\r\n            <>\r\n              {candyMachine && (\r\n                <Grid\r\n                  container\r\n                  direction=\"row\"\r\n                  justifyContent=\"center\"\r\n                  wrap=\"nowrap\"\r\n                >\r\n                  <Grid item xs={3}>\r\n                    <Typography variant=\"body2\" color=\"textSecondary\">\r\n                      Remaining\r\n                    </Typography>\r\n                    <Typography\r\n                      variant=\"h6\"\r\n                      color=\"textPrimary\"\r\n                      style={{\r\n                        fontWeight: 'bold',\r\n                      }}\r\n                    >\r\n                      {`${itemsRemaining}`}\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={4}>\r\n                    <Typography variant=\"body2\" color=\"textSecondary\">\r\n                      {isWhitelistUser && discountPrice\r\n                        ? 'Discount Price'\r\n                        : 'Price'}\r\n                    </Typography>\r\n                    <Typography\r\n                      variant=\"h6\"\r\n                      color=\"textPrimary\"\r\n                      style={{ fontWeight: 'bold' }}\r\n                    >\r\n                      {isWhitelistUser && discountPrice\r\n                        ? `◎ ${formatNumber.asNumber(discountPrice)}`\r\n                        : `◎ ${formatNumber.asNumber(\r\n                            candyMachine.state.price,\r\n                          )}`}\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={5}>\r\n                    {isActive && endDate && Date.now() < endDate.getTime() ? (\r\n                      <>\r\n                        <MintCountdown\r\n                          key=\"endSettings\"\r\n                          date={getCountdownDate(candyMachine, currentShift)}\r\n                          style={{ justifyContent: 'flex-end' }}\r\n                          status=\"COMPLETED\"\r\n                          onComplete={() => toggleMintButton(currentShift)}\r\n                        />\r\n                        <Typography\r\n                          variant=\"caption\"\r\n                          align=\"center\"\r\n                          display=\"block\"\r\n                          style={{ fontWeight: 'bold' }}\r\n                        >\r\n                          TO END OF MINT\r\n                        </Typography>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <MintCountdown\r\n                          key=\"goLive\"\r\n                          date={getCountdownDate(candyMachine, currentShift)}\r\n                          style={{ justifyContent: 'flex-end' }}\r\n                          status={\r\n                            candyMachine?.state?.isSoldOut ||\r\n                            (endDate && Date.now() > endDate.getTime())\r\n                              ? 'COMPLETED'\r\n                              : isPresale\r\n                              ? 'PRESALE'\r\n                              : 'LIVE'\r\n                          }\r\n                          onComplete={() => toggleMintButton(currentShift)}\r\n                        />\r\n                        {isPresale &&\r\n                          candyMachine.state.goLiveDate &&\r\n                          candyMachine.state.goLiveDate.toNumber() +\r\n                            currentShift >\r\n                            new Date().getTime() / 1000 && (\r\n                            <Typography\r\n                              variant=\"caption\"\r\n                              align=\"center\"\r\n                              display=\"block\"\r\n                              style={{ fontWeight: 'bold' }}\r\n                            >\r\n                              UNTIL PUBLIC MINT\r\n                            </Typography>\r\n                          )}\r\n                      </>\r\n                    )}\r\n                  </Grid>\r\n                </Grid>\r\n              )}\r\n              <MintContainer>\r\n                {candyMachine?.state.isActive &&\r\n                candyMachine?.state.gatekeeper &&\r\n                wallet.publicKey &&\r\n                wallet.signTransaction ? (\r\n                  <GatewayProvider\r\n                    wallet={{\r\n                      publicKey:\r\n                        wallet.publicKey ||\r\n                        new PublicKey(CANDY_MACHINE_PROGRAM),\r\n                      //@ts-ignore\r\n                      signTransaction: wallet.signTransaction,\r\n                    }}\r\n                    gatekeeperNetwork={\r\n                      candyMachine?.state?.gatekeeper?.gatekeeperNetwork\r\n                    }\r\n                    clusterUrl={rpcUrl}\r\n                    cluster={cluster}\r\n                    handleTransaction={async (transaction: Transaction) => {\r\n                      setIsUserMinting(true);\r\n                      const userMustSign = transaction.signatures.find(sig =>\r\n                        sig.publicKey.equals(wallet.publicKey!),\r\n                      );\r\n                      if (userMustSign) {\r\n                        setAlertState({\r\n                          open: true,\r\n                          message: 'Please sign one-time Civic Pass issuance',\r\n                          severity: 'info',\r\n                        });\r\n                        try {\r\n                          transaction = await wallet.signTransaction!(\r\n                            transaction,\r\n                          );\r\n                        } catch (e) {\r\n                          setAlertState({\r\n                            open: true,\r\n                            message: 'User cancelled signing',\r\n                            severity: 'error',\r\n                          });\r\n                          // setTimeout(() => window.location.reload(), 2000);\r\n                          setIsUserMinting(false);\r\n                          throw e;\r\n                        }\r\n                      } else {\r\n                        setAlertState({\r\n                          open: true,\r\n                          message: 'Refreshing Civic Pass',\r\n                          severity: 'info',\r\n                        });\r\n                      }\r\n                      try {\r\n                        await sendTransaction(\r\n                          props.connection,\r\n                          wallet,\r\n                          transaction,\r\n                          [],\r\n                          true,\r\n                          'confirmed',\r\n                        );\r\n                        setAlertState({\r\n                          open: true,\r\n                          message: 'Please sign minting',\r\n                          severity: 'info',\r\n                        });\r\n                      } catch (e) {\r\n                        setAlertState({\r\n                          open: true,\r\n                          message:\r\n                            'Solana dropped the transaction, please try again',\r\n                          severity: 'warning',\r\n                        });\r\n                        console.error(e);\r\n                        // setTimeout(() => window.location.reload(), 2000);\r\n                        setIsUserMinting(false);\r\n                        throw e;\r\n                      }\r\n                      await onMint();\r\n                    }}\r\n                    broadcastTransaction={false}\r\n                    options={{ autoShowModal: false }}\r\n                  >\r\n                    <MintButton\r\n                      candyMachine={candyMachine}\r\n                      isMinting={isUserMinting}\r\n                      setIsMinting={val => setIsUserMinting(val)}\r\n                      onMint={onMint}\r\n                      isActive={\r\n                        isActive ||\r\n                        (isPresale && isWhitelistUser && isValidBalance)\r\n                      }\r\n                    />\r\n                  </GatewayProvider>\r\n                ) : (\r\n                  <MintButton\r\n                    candyMachine={candyMachine}\r\n                    isMinting={isUserMinting}\r\n                    setIsMinting={val => setIsUserMinting(val)}\r\n                    onMint={onMint}\r\n                    isActive={\r\n                      isActive ||\r\n                      (isPresale && isWhitelistUser && isValidBalance)\r\n                    }\r\n                  />\r\n                )}\r\n              </MintContainer>\r\n            </>\r\n          )}\r\n          <Typography\r\n            variant=\"caption\"\r\n            align=\"center\"\r\n            display=\"block\"\r\n            style={{ marginTop: 7, color: 'grey' }}\r\n          >\r\n            Powered by METAPLEX\r\n          </Typography>\r\n        </Paper>\r\n      </Container>\r\n\r\n      <Snackbar\r\n        open={alertState.open}\r\n        autoHideDuration={\r\n          alertState.hideDuration === undefined ? 6000 : alertState.hideDuration\r\n        }\r\n        onClose={() => setAlertState({ ...alertState, open: false })}\r\n      >\r\n        <Alert\r\n          onClose={() => setAlertState({ ...alertState, open: false })}\r\n          severity={alertState.severity}\r\n        >\r\n          {alertState.message}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Container>\r\n  );\r\n};\r\n\r\nconst getCountdownDate = (\r\n  candyMachine: CandyMachineAccount,\r\n  currentShift: number,\r\n): Date | undefined => {\r\n  if (\r\n    candyMachine.state.isActive &&\r\n    candyMachine.state.endSettings?.endSettingType.date\r\n  ) {\r\n    return toDate(candyMachine.state.endSettings.number);\r\n  }\r\n\r\n  return toDate(\r\n    candyMachine.state.goLiveDate\r\n      ? new anchor.BN(candyMachine.state.goLiveDate.toNumber() + currentShift)\r\n      : candyMachine.state.isPresale\r\n      ? new anchor.BN(new Date().getTime() / 1000)\r\n      : undefined,\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}